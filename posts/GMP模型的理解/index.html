<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="这是一个个人博客，记录技术学习和生活感悟"><title>GMP模型的理解 | RenaXu 's Wonderland</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="/css/custom-icons.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="/css/toc.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><div class="darkmode-toggle">🌓</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 8.1.1"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">GMP模型的理解</h1><a id="logo" href="/.">RenaXu 's Wonderland</a><p class="description">分享技术与生活</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-4-4"><div class="content_container"><div class="post"><h1 class="post-title">GMP模型的理解</h1><div class="post-meta">2025-09-19<span> | </span><span class="category"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 1k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 3</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div></div></div><div class="post-content"><p>GMP 是 Go 语言特有的协程调度模型：</p>
<p>其中 G 代表 Goroutine（协程），</p>
<p>M 代表 Machine（工作线程），</p>
<p>P 代表 Processor（逻辑处理器），</p>
<p>其中G、P 在用户空间，M在内核空间。</p>
<p>Goroutine（协程）本质上是一个go程序的函数，在主函数中用go关键字标注，那么这个函数就会独立于主函数并发并发运行，也就是说它可以不按程序的顺序执行，而是他会被Go runtime中的P(处理器)管理，由P决定它应该交给哪个工作线程运行。特别注意！！！go程序中所有的函数都会被当做协程对象，Go 程序中，<strong>所有代码最终都会通过协程（G）执行</strong>—— 即使是 <code>main</code> 函数这样的 “主逻辑”，本质上也是作为一个特殊的协程（主协程）运行的。</p>
<p>Processor（逻辑处理器）本质上是用户态的一个数据结构，其中维护了一个存储Goroutine的队列。 Go runtime 在用户态维护了一张 “M-P 绑定表”。当 M 需要运行 G 时，会向 Go runtime 请求绑定一个空闲的 P，绑定后 M 就能访问该 P 管理的本地 G 队列。P 的数量通常与 CPU 核心数相关（可通过 GOMAXPROCS 设置），一般取等，尽可能让在不同cpu上的M绑定p,充分利用cpu资源，除了每个 P 的本地队列，还有一个全局队列，当本地队列空时，M 会从其他 P 的队列或全局队列偷取 G 来执行（工作窃取机制）。</p>
<p>Machine（工作线程）位于内核态，在go程序开始运行时，由Go runtime创建，程序结束他会被系统回收其创建时的资源，当 M 执行 G 的代码时，M 会加载 G 的栈指针、程序计数器等上下文，会从内核态切换到用户态，当需要系统调用时，再从用户态切回内核态。</p>
<blockquote>
<p>小提示：系统调用是用户态程序通过<strong>内核</strong>提供的接口，让内核完成它没权限做的事；而操作系统是 “内核 + 上层工具” 的整体，内核是其中负责处理系统调用、管理硬件的核心。</p>
</blockquote>
<p>Go 语言的设计理念是 “一切皆协程”，如果在函数内部函数的并发运行，离不开工作线程，工作线程通过p获得g,因为g的切换完全在用户空间上的，加上g切换的资源开销非常小，使得在一个工作线程中可以执行多个协程，而无需自己切换，所以子协程即使崩了，也不会影响父协程的运行。这当然也有隐患，所以需要考虑并发问题和子协程和父协程的通信问题。</p>
<p>介绍了协程，这不得不再知识衍生到线程和进程：</p>
<p>进程是操作系统进行<strong>资源分配（如内存、文件描述符）的基本单位</strong>，值得注意的是，即使程序暂时未被 CPU 调度（处于就绪 &#x2F; 阻塞态），只要已加载到内存并拥有独立资源空间，仍属于进程，进程的<strong>数据、代码、文件描述符、</strong></p>
<p><strong>虚拟内存空间</strong>是进程级独有资源（后续线程会共享），而<strong>寄存器、堆栈</strong>实际是线程运行时的私有资源。</p>
<p>线程的创建依赖于进程，线程切换快，核心是因为无需切换进程的<strong>地址空间（虚拟内存映射表）</strong> —— 进程切换需让 CPU 重新加载地址空间，而线程切换仅需保存 &#x2F; 恢复自身的寄存器和栈上下文，操作成本远低于进程。因此说他是cpu调度的基本单位，</p>
<p>总之：操作系统通过进程划分资源边界（避免资源冲突），通过线程实现 CPU 的高效调度（减少资源切换开销）</p>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E4%BA%AB/" rel="tag">分享</a></li></ul></div><div class="post-nav"><a class="pre" href="/posts/kafka%E7%9A%84%E7%90%86%E8%A7%A3/">Kafka的理解？</a><a class="next" href="/posts/Git%E5%90%88%E5%B9%B6%E5%86%B2%E7%AA%81%E8%A7%A3%E5%86%B3%E4%B8%8E%E6%93%8D%E4%BD%9C%E9%80%BB%E8%BE%91%EF%BC%88AI%E7%89%88%EF%BC%89/">Git合并冲突解决与操作逻辑（AI版）</a></div></div></div></div><div class="pure-u-1 pure-u-md-4-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">RenaXu 's Wonderland.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script><script type="text/javascript" src="/js/toc.js?v=1.0.0"></script></div></body></html>